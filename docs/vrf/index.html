<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Secure Firewall Essentials Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Secure Firewall Essentials Blog Atom Feed"><title data-react-helmet="true">Virtual Routing and Forwarding | Secure Firewall Essentials</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Virtual Routing and Forwarding | Secure Firewall Essentials"><meta data-react-helmet="true" name="description" content="Configuring VRF on Secure Firewall"><meta data-react-helmet="true" property="og:description" content="Configuring VRF on Secure Firewall"><meta data-react-helmet="true" property="og:url" content="https://securefirewallessentials.github.io/securefirewallessentials//docs/vrf"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://securefirewallessentials.github.io/securefirewallessentials//docs/vrf"><link rel="stylesheet" href="/styles.a0ebc7b8.css">
<link rel="preload" href="/styles.984ba014.js" as="script">
<link rel="preload" href="/runtime~main.32bb7309.js" as="script">
<link rel="preload" href="/main.dcc679c3.js" as="script">
<link rel="preload" href="/1.daadf3d3.js" as="script">
<link rel="preload" href="/30.7c88bcd9.js" as="script">
<link rel="preload" href="/31.d754188b.js" as="script">
<link rel="preload" href="/935f2afb.f4b7ee82.js" as="script">
<link rel="preload" href="/29.57805d62.js" as="script">
<link rel="preload" href="/0d8a1c10.054f8eca.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="NetSec Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="NetSec Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Secure Firewall Essentials</strong></a><a class="navbar__item navbar__link" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="NetSec Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="NetSec Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Secure Firewall Essentials</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">FMC Best Practices</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/">Smart Licensing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/discovery-policy">Discovery Policy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/file-policy">File and Malware Policy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/intrusion-policy">Intrusion Policy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/ssl-policy">SSL Policy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/access-control-policy">Access Control Policy</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Features</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/snmp">SNMP Monitoring</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/vrf">Virtual Routing and Forwarding</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">White Papers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sips-wp">Secure IPS</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Glossary</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/glossary">Secure Firewall Glossary</a></li></ul></li></ul></div><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_2WRA"><svg width="20" height="20" role="img" class="collapseSidebarButtonIcon_CoMu"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Virtual Routing and Forwarding</h1></header><div class="markdown"><p>May 22, 2021</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>The Virtual Routing and Forwarding (VRF) feature was added in Firepower
Threat Defense (FTD) software release 6.6 to allow for segregation of
routing tables. Also, VRF allows network segments with overlapping IP
address spaces. VRF implementation on FTD is akin to VRF-lite on Cisco
routers. You can also use VRFs for routing plane separation during
migration from multi-context ASAs to FTD.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="configuration"></a>Configuration<a class="hash-link" href="#configuration" title="Direct link to heading">#</a></h2><p>Using VRF, we can separate the NGFW/NGIPS functions for different
routing domains across an enterprise network. Also, it allows for
overlapping address space to co-exist and communicate through the FTD.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The FMC and FDM UI refer to a VRF as Virtual Router. These terms
will be used interchangeably.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="firepower-management-center"></a>Firepower Management Center<a class="hash-link" href="#firepower-management-center" title="Direct link to heading">#</a></h3><p>This section showcases the configuration steps using
Firepower Management Center.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="creating-a-vrf"></a>Creating a VRF<a class="hash-link" href="#creating-a-vrf" title="Direct link to heading">#</a></h4><p>Step 1: Choose <strong>Devices &gt; Devices Management</strong>. Click on the <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAXCAYAAAAV1F8QAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAhGVYSWZNTQAqAAAACAAFARIAAwAAAAEAAQAAARoABQAAAAEAAABKARsABQAAAAEAAABSASgAAwAAAAEAAgAAh2kABAAAAAEAAABaAAAAAAAAANwAAAABAAAA3AAAAAEAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAGqADAAQAAAABAAAAFwAAAAAP+/DJAAAACXBIWXMAACHVAAAh1QEEnLSdAAACZmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNi4wLjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgICAgICAgICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICAgICA8dGlmZjpSZXNvbHV0aW9uVW5pdD4yPC90aWZmOlJlc29sdXRpb25Vbml0PgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+NDY8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+NTE8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpDb2xvclNwYWNlPjE8L2V4aWY6Q29sb3JTcGFjZT4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cn+kNEsAAAIdSURBVEgNvZTda9NQGMafnKRGVp1s/cALbQVhKtjBrrdVtl7UTirO6n/k8F9Q/AuE0W5XS/ZRUBTc3Fb1Yg5vrBsyPyqsdjVbahLfc6BQWdsl28hJICGQ9/c+z3nOKxl7+w58WAocXzhgPogRCN9AykkVOS3WS5LUsdyJQYFAABxgWRZs2z5dEFfBGEOj0cDGxw1UflVw7foNXIxEKVvtw+V5jwRElgVkde0tnjx7ikePp7D5aRN2BwiX6ck6DpEJYhh/sLyygsJsAZXKT6TGUrhyKQaZcQsdsvKwg65BTUhtr4al4hI0XUO9XsfoyCgmMhOIX47THrWHuFbEIYqioPq7Ck3TMKfPwTRNpMZTyN7JIhqJwOoSBJcg6pLJ2Pn+A8XiAuYXdNH57XQamXQG4XAEfylx3aLtCsQh5e1tFGby+PBuHUxWkMvdQ5Is6z1/QcT6KMiRIEli+PxlC9P553hfKiEYPIfJ+5NIDicR7Am6hnQF8XPydecb8jPTKK2vIRQKIZu9i1sjSahnznqCdAWZDRNvll/j1csXuDowgAe5hxhKDBJEFRPAjV0c0FySUTP+O8oiYbQP5a0y9EUd0XAUiZsJxGJxKHSG+JjxCuGwQyDxkU7cbnUX+wcHCPX1Q1VVYZUDSiBdx1ltQaIQ1WMUBq7wuCpaG+o8GchQy7ZIM93tZkprFRfvnUH082kAmj14nt7NH70+fQP9A+9v0e/nORWyAAAAAElFTkSuQmCC">
icon against the FTD you wish to configure for VRFs.</p><p>Step 2: Click on the <strong>Routing</strong> tab.</p><p><img src="/assets/images/image2-0bb4efdd3d8cf79f88373b39cd0a3f8f.png"></p><p>Step 3: Click <strong>Manage Virtual Routers.</strong> Notice that all the interfaces
are assigned to the <strong>Global</strong> VRF, which is the default configuration.</p><p><img src="/assets/images/image2-0bb4efdd3d8cf79f88373b39cd0a3f8f.png"></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Under <strong>Manage Virtual Routers</strong>, there is a dropdown menu to
select a VRF. After creating a new VRF, use this to select that VRF and
configure settings within the VRF, such as interface assignments, static
and dynamic routing.</p></div></div><p>Step 4: Click <strong>+ Add Virtual Router</strong></p><p><img src="/assets/images/image2-0bb4efdd3d8cf79f88373b39cd0a3f8f.png"></p><p>Step 5: Enter the VRF name and description. Click <strong>OK</strong>.</p><p><img src="/assets/images/image3-2bda0bbb2aca8e6b7f00df1cbd3c9198.png"></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Verify the VRF name before assigning interfaces to the VRF. The
FMC does not allow editing the name of the VRF once it is created. If
you wish to change the VRF name, you need to click on <strong>Manage Virtual
Routers,</strong> delete the VRF and recreate the VRF with the correct name.</p></div></div><p>Step 6: Now, you will be redirected to the <strong>Virtual Router Properties</strong>
page with the newly created VRF selected in the dropdown menu. Select
the interface/s from the <strong>Available Interfaces</strong> and click <strong>Add.</strong></p><p><img src="/assets/images/image4-e766b38fed74d08f7590e283521ad496.png"></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p><strong>Available Interfaces</strong> only the interfaces configured with a
logical name and not assigned to another user-defined VRF.</p></div></div><p>Step 7: You can repeat Steps 3 to 6 for adding more VRFs.</p><p>Step 8: Remember to save the changes after adding the VRFs. <img src="/assets/images/image5-29b192241d4b2070c41d56977ece8e42.png"></p><p>Step 9: Deploy from the FMC if you are not making any more configuration
changes.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="configure-static-routes-for-vrf"></a>Configure Static Routes for VRF<a class="hash-link" href="#configure-static-routes-for-vrf" title="Direct link to heading">#</a></h4><p>You can use Static routes for intra VRF routing or to leak routes into
other user-defined VRFs or the global VRF. When selecting an interface
for the static route, the FMC shows the VRF that the interface belongs
to.</p><p>Step 1: Select the VRF from the dropdown menu under <strong>Manage Virtual
Routers.</strong></p><p><img src="/assets/images/image6-b6279db0053733fbb33252ad42a1dd40.png"></p><p>Step 2: Click on <strong>Static Route.</strong></p><p><img src="/assets/images/image7-2807deb21c5ff7e81b61279d3bb8c438.png"></p><p>Step 3: Click on <strong>Add Route.</strong></p><p><img src="/assets/images/image8-64c6e76a2c6e196d405dd08339962974.png"></p><p>Step 4: Select <strong>IPv4</strong> or <strong>IPv6</strong></p><p>Step 5: Select an interface from the interface dropdown list</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>FMC shows the VRF assignment of each interface. Interfaces that
are part of Global VRF have the word <strong>Global</strong> shown against them. For
route leaking, don&#x27;t specify the next hop.</p></div></div><p>Step 6: Select Network from the <strong>Available Network</strong> dropdown list.
Click <strong>Add</strong> to populate the table named <strong>Selected Network</strong>.</p><p>Step 7: Select next hop from the <strong>Gateway</strong> dropdown list. If leaking
routes, leave this blank.</p><p>Step 8: Click <strong>OK.</strong></p><p><img src="/assets/images/image9-48fd24850e0104c9877dc38ef2927747.png"></p><p>Step 9: Click <strong>Save</strong> to save the changes to the VRF configuration.</p><p><img src="/assets/images/image10-2cb5498451398eb15576ff4946eaecde.png"></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>You must leak the route in the reverse direction as well if the
traffic is not matching any inspection rules such as ICMP inspection. If
the Gateway objects don&#x27;t exist, you can create a new object from the
route configuration window.</p></div></div><p>Step 10: Deploy from FMC if you are not making any more configuration
changes.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="configure-ospf-for-vrf"></a>Configure OSPF for VRF<a class="hash-link" href="#configure-ospf-for-vrf" title="Direct link to heading">#</a></h4><p>FTD supports OSPFv2 for user-defined VRFs and OSPFv2/v3 for Global VRFs.</p><p>Step 1: Select the VRF from the dropdown menu under <strong>Manage Virtual
Routers.</strong></p><p><img src="/assets/images/image6-b6279db0053733fbb33252ad42a1dd40.png"></p><p>Step 2: Click on <strong>OSPF.</strong></p><p>Step 3: Check the <strong>Process 1</strong> checkbox.</p><p><img src="/assets/images/image11-27a30593b6b722ef34aad9782635694d.png"></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The Process ID is pre-filled and cannot be changed. FTD allows 2
OSPF processes per VRF. The numbers 1 and 2 are reserved for the OSPF
Process IDs in global VRF. The next two numbers, 3 and 4, are allocated
to the two OSPF Process IDs in the first user-defined VRFs. This
incremental pattern continues whenever OSPF is enabled in the next
user-defined VRF.</p></div></div><p>Step 4: The rest of the OSPF configuration is similar to a non-VRF aware
OSPF configuration.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p><strong>Interface</strong>Â allows you to select only the interfaces of the
virtual router that you are configuring.Â OSPFv3 configuration is
available only in the Global VRF.</p></div></div><p>Step 5: Deploy from FMC if you are not making any more configuration
changes.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="configure-bgp-for-vrf"></a>Configure BGP for VRF<a class="hash-link" href="#configure-bgp-for-vrf" title="Direct link to heading">#</a></h4><p>All VRFs share a single BGP process with each VRF as an address family
within that process. That is why the BGP configuration is split into two
steps. There are general settings (e.g. AS number) and per user-defined
VRF settings.</p><p>Step 1: In the same column as the <strong>Manage Virtual Routers</strong>, click on
<strong>BGP</strong> under <strong>General Settings</strong> (Irrespective of the VRF selected
under Manage Virtual Routers).</p><p><img src="/assets/images/image12-3fe0cf987185a592c4b8489c3f6cc99a.png"></p><p>Step 2: Check the checkbox named <strong>Enable BGP.</strong> Enter the AS number.</p><p><img src="/assets/images/image13-16ccf81a8bca89dcb4d491203237cc91.png"></p><p>Step 3: Configure the rest of the BGP General Settings.</p><p>Step 4: Select a VRF from the dropdown menu under <strong>Manage Virtual
Routers.</strong></p><p>Step 5: Click <strong>BGP.</strong> Configure the BGP settings specific to the
selected VRF.</p><p><img src="/assets/images/image14-486f63003a7bea6c3f9dceb7a5a0cc36.png"></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>You cannot change all the global BGP settings within User-defined
VRFs. However, you can override the router-Id within each VRF. The rest
of the BGP configuration is similar to non-VRF aware BGP configuration.</p></div></div><p>Step 6: Click <strong>IPv4</strong> under <strong>BGP.</strong> Click on <strong>Enable IPv4.</strong>
Configure the IPv4 address family settings.</p><p><img src="/assets/images/image15-09e7afb7c2dbb4c5ba4c7adc12833d31.png"></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>User-defined VRFs support BGP IPv4 address family, whereas Global
VRFs BGP configuration supports IPv4 and IPv6 address families.</p></div></div><p>Step 7: Deploy from FMC if you are not making any more configuration
changes.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="firepower-device-manager"></a>Firepower Device Manager<a class="hash-link" href="#firepower-device-manager" title="Direct link to heading">#</a></h3><p>This section showcases the configuration steps using the Firepower
Device Manager. Release 6.6 the BGP and OSPF configurations from
Advanced Settings to Routing.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="creating-a-vrf-1"></a>Creating a VRF<a class="hash-link" href="#creating-a-vrf-1" title="Direct link to heading">#</a></h4><p>Step 1: Click <strong>View Configuration</strong> under Routing section.</p><p><img src="/assets/images/image16-546375181ac596b1bf77db9c7acbf2c1.png"></p><p>Step 2: Click on the dropdown named <strong>Add Multiple Virtual Routers.</strong>
Click on <strong>Create First Custom Virtual Router</strong>.</p><p><img src="/assets/images/image17-cc6c31a6ced69ce045f331cdafb804db.png"></p><p>Step 3: Enter the details such as VRF name, description. Under
<strong>Interfaces</strong>, click on the <strong>+</strong> icon and select the interface/s for
this VRF and click <strong>OK.</strong> Click <strong>OK</strong> again to save the VRF
configuration.</p><p><img src="/assets/images/image18-21b9dd607a841e08d185311a543d3999.png"></p><p>Step 4: Now, you will see the newly created VRF along with the Global
VRF.</p><p><img src="/assets/images/image19-0d225b7287a52e901ee38465ad939283.png"></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>By default, all the interfaces are assigned to the Global VRF.</p></div></div><p>Step 5: You can edit the various VRF properties like the VRF name,
description and interface assignments. Click on the <strong>view</strong> icon and
then click on the tab named <strong>Virtual Router Properties.</strong></p><p><img src="/assets/images/image20-5ef46763ab5d5044c78f5a825d381e9d.png"></p><p><img src="/assets/images/image21-0b3f606eb5a5a5fdfb75377380bd639f.png"></p><p>Step 6: Click on the <strong>+</strong> icon to add and configure more VRFs.</p><p><img src="/assets/images/image22-12348ba82dc96a276aeb032487771ca4.png"></p><p>Step 7: You can toggle between different VRFs after configuring a VRF.</p><p><img src="/assets/images/image23-4ca79beec7ea3de961068d69e590ebf2.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="configure-static-routes-for-vrf-1"></a>Configure Static Routes for VRF<a class="hash-link" href="#configure-static-routes-for-vrf-1" title="Direct link to heading">#</a></h4><p>You can use Static routes for intra VRF routing or to leak connected or
static routes into other user-defined VRFs or the global VRF. When you
select the static route interface, FDM will warn that the routes will be
leaked.</p><p>Step 1: Select the VRF of choice and view the VRF properties by clicking
the <strong>view</strong> icon. The <strong>Static Routing</strong> is auto selected.</p><p><img src="/assets/images/image20-5ef46763ab5d5044c78f5a825d381e9d.png"></p><p>Step 2: Click on <strong>Create Static Route</strong>.</p><p><img src="/assets/images/image24-d9bc4ca6a4dcc7c424215799858cfa41.png"></p><p>Step 3: Enter <strong>Name</strong> and <strong>Description</strong>. <img src="/assets/images/image25-ed4c00ad4b285d6fb9826ccf6341c502.png"></p><p>Step 4: From the <strong>Interface</strong> dropdown menu, select an interface. The
UI shows the VRF the interface belongs to. If the interface belongs to a
different VRF, the UI warns about the route being leaked.</p><p>Step 5: Select <strong>IPv4</strong> or <strong>IPv6</strong>. Select the <strong>Networks</strong> by clicking
on the + icon. Specify the Gateway from the dropdown. If configuring
route leak, leave the gateway blank. Click <strong>OK</strong>.</p><p><img src="/assets/images/image26-a8068cb32c806bac7ed93513b1d5554b.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="configure-ospf-for-vrf-1"></a>Configure OSPF for VRF<a class="hash-link" href="#configure-ospf-for-vrf-1" title="Direct link to heading">#</a></h4><p>FTD supports OSPFv2 for user-defined VRFs and OSPFv2/v3 for Global VRFs.</p><p>Step 1: From the VRF settings page, select <strong>OSPF</strong> tab.</p><p><img src="/assets/images/image27-5f8c823ce532e8adfd00d061e2d1423c.png"></p><p>Step 2: Click <strong>CREATE OSPF OBJECT</strong> and select <strong>OSFP</strong>.</p><p><img src="/assets/images/image28-6a3ca71f65ef75931b853d2b3f6a8a94.png"></p><p>Step 3: You will see the SMART CLI interface for OSPF routing
configuration. By default, it shows only the OSPF process ID and
adjacency change log settings. Click on <strong>Show disabled (</strong> it will
change to Hide disabled ) to view more settings.</p><p><img src="/assets/images/image29-40a473b3abfa8b69000cde74ef5ba3da.png"></p><p>Step 4: Enter the name for the OSPF object and provide other details. To
enable and edit certain lines, click the <strong>+</strong> on the left.</p><p>Step 5: Click <strong>OK</strong>.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>FTD allows 2 OSPF processes per VRF.</p></div></div><p><img src="/assets/images/image30-55c11a8e6498fc70ab1e225f49278770.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="configure-bgp-for-vrf-1"></a>Configure BGP for VRF<a class="hash-link" href="#configure-bgp-for-vrf-1" title="Direct link to heading">#</a></h4><p>All VRFs share a single BGP process with each VRF as an address family
within that process. That is why the BGP configuration is split into two
steps. There are general settings (e.g. AS number) and per user-defined
VRF settings. Configure BGP Global Settings only if configuring BGP in a
VRF.</p><p>Step 1: From the Routing page, click on <strong>BGP Global Settings</strong>.</p><p><img src="/assets/images/image31-c44f768e71c58e1ab576d2f574fe2c5e.png"></p><p>Step 2: Click on <strong>CREATE BGP GLOBAL SETTINGS OBJECT.</strong></p><p><img src="/assets/images/image32-00d682f537cfaa72fbdc80abaff5756e.png"></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>You will see this popup only when configuring BGP Global Settings
for the first time.</p></div></div><p>Step 3: You will see the SMART CLI interface for BGP Global routing
configuration. The name is pre-filled with <strong>BgpGeneralSettings</strong> and
can be edited. Enter the BGP configuration, such as the AS number,
amongst others. Click on <strong>Show disabled</strong> to view more settings. Click
<strong>OK</strong>.</p><p><img src="/assets/images/image33-6eb6ad04f655b7b3f9397d6787502112.png"></p><p>Step 4: Now, click on the <strong>View</strong> icon for the VRF to configure for
BGP. Select the <strong>BGP</strong> tab.</p><p><img src="/assets/images/image20-5ef46763ab5d5044c78f5a825d381e9d.png"></p><p><img src="/assets/images/image34-2c3d8b2e814e5faf619eb2f2f6e39f7e.png"></p><p>Step 5: Click on <strong>CREATE BGP OBJECT</strong>.</p><p><img src="/assets/images/image34-2c3d8b2e814e5faf619eb2f2f6e39f7e.png"></p><p>Step 6: You will see the SMART CLI interface for BGP routing
configuration. Click on <strong>Show disabled</strong> to view more settings. Enter
<strong>Name</strong> and Description. Provide the <strong>as-number</strong> and <strong>ip-protocol</strong>
information.</p><p><img src="/assets/images/image35-52ef3d6bb948ba69ea6190e1573f15f0.png"></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The as-number should match the one defined in the BGP Global
Settings Object. The ip-protocol can be IPv4 only as user-defined VRFs
support BGP IPv4 address family only. Global VRFs BGP configuration
supports both IPv4 and IPv6 address families. Creating the BGP object
within a VRF without creating the BGP Global Configuration Settings
object creates the BGP Global Configuration Settings object
automatically.</p></div></div><p>Step 8: Deploy the changes.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="multi-instance-with-vrf"></a>Multi-Instance with VRF<a class="hash-link" href="#multi-instance-with-vrf" title="Direct link to heading">#</a></h2><p>VRF configuration remains the same when using multi-instance on the
Firepower platforms. However, the number of VRFs in an instance depends
on the number of cores allocated to that instance and are calculated as
follows:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">VRF_INSTANCE = (MAX_VRF_PLATFORM / MAX_CORES_PLATFORM) \*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(CORES_IN_INSTANCE)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Let&#x27;s use the example of FP9300 SM-36 module to calculate the number of
VRFs in an instance. This platform supports a maximum of 70 cores and
100 VRFs. Here is the calculation for the VRFs in an instance with 20
cores:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(100/70)\*20 = 28 ( We use the value rounded down after calculation )</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="how-do-policies-interact-with-vrf"></a>How do policies interact with VRF<a class="hash-link" href="#how-do-policies-interact-with-vrf" title="Direct link to heading">#</a></h2><p>Assigning the interfaces to different VRFs segments the routing table.
However, the Security Policies consider the interface&#x27;s Security Zone,
which implies that the policy evaluation is not VRF aware by default.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The Security Intelligence policy is not VRF aware. If an IP
address, domain or URL is blocked as part of Security Intelligence, it
will be blocked across all the VRFs.</p></div></div><p>E.g. If you create a rule with the source zone as &quot;any,&quot; it will be
matched to traffic originating from all interfaces across all VRFs.</p><p>For applying policies based on VRF, you need to assign the same Security
Zone to all the interfaces from a VRF and then use that Security Zone in
the security policy.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="overlapping-ip-addresses"></a>Overlapping IP addresses<a class="hash-link" href="#overlapping-ip-addresses" title="Direct link to heading">#</a></h3><p>VRFs create mutually exclusive routing tables, enabling FTD to allow
overlapping or same address spaces across different VRFs. While creating
a security policy, we need to be aware of overlapping IP subnets.</p><p>E.g. IP subnet 192.168.1.0/24 exists in VRF-A and VRF-B. The network
administrators requires users in VRF-A to have Internet access and users
in VRF-B to not have Internet access. If you create a security policy
that allows Internet access based solely on the source IP network, you
will inadvertently allow access to the Internet from both VRFs. You need
to assign the interfaces belonging to VRF-A and VRF-B in different
Security Zones. Use the Security Zone assigned to the VRF-A interfaces
and the source IP network to allow Internet access.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="limitations"></a>Limitations<a class="hash-link" href="#limitations" title="Direct link to heading">#</a></h3><p>Identity policies require different realms per VRF and different ISE
connections per VRF to segregate the user-IP and SGT-IP mappings per
VRF.</p><p>Features such as Threat Intelligence Director (TID), Host Profiling and
Malware Trajectory rely on the FMC to map the network. Overlapping IP
addresses make it impossible to differentiate when the same IP address
belongs to two different hosts. When an overlapping IP segment exists on
the same device across multiple VRFs, the analysis from these features
is not accurate.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="how-nat-interacts-with-vrf"></a>How NAT interacts with VRF<a class="hash-link" href="#how-nat-interacts-with-vrf" title="Direct link to heading">#</a></h2><p>FTD uses NAT and/or a routing table for selecting the egress interface
and the next hop adjacency resolution. NAT can be used to leak routes
across two VRFs and also as a way of enabling communication between
overlapping subnets.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="route-leaking-using-nat"></a>Route Leaking using NAT<a class="hash-link" href="#route-leaking-using-nat" title="Direct link to heading">#</a></h3><p>If you configure NAT rules with the source and destination interfaces in
different VRFs, it will allow the traffic to pass from one VRF to
another. However, suppose you do not specify the route lookup option. In
that case, the NAT configuration determines the egress interface and the
traffic will be sent to the VRF mapped to the destination interface
without validating if the destination VRF has a route. We recommended
using static routes for route leaking along with a NAT policy
configuration.</p><p><img src="/assets/images/image36-8416dbc9e9b56f3f88fec7fdba33e1f3.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="overlapping-ip-addresses-1"></a>Overlapping IP addresses<a class="hash-link" href="#overlapping-ip-addresses-1" title="Direct link to heading">#</a></h3><p><img src="/assets/images/image37-39a56440c0c01c1f214cd028ec13e1cf.png"></p><p>If a NAT rule is applied to VRFs with overlapping IP address spaces,
ensure that the source interface is specified in a NAT rule for each
VRF, ideally along with separate NAT/PAT pools. Using &#x27;any&#x27; in the
source interface causes reverse translation to fail. Even without
overlapping IP addresses, it is highly recommended to use specific
interface definitions in the NAT rules.</p><p>NAT can enable overlapping subnets to communicate with each other,
without using BVIs or another network hop as shown in this example:</p><p><img src="/assets/images/image38-78f1c5d7cf2e2eac26b8fc3c4ba360eb.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="verification-and-troubleshooting"></a>Verification and Troubleshooting<a class="hash-link" href="#verification-and-troubleshooting" title="Direct link to heading">#</a></h2><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">show vrf -- the command will show the configured VRFs and their</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">interface assignments.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><img src="/assets/images/image39-a04f24a095e4596d4775df21c549a64c.png"></p><p>VRF specific routing information can be viewed using the below commands:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">show route \[vrf name\]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">show ospf \[ vrf name \| all\]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">show bgp \[ vrf name \| all\]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>A special SI route flag shows leaked routes in the routing table.</p><p><img src="/assets/images/image40-9c26ce8817776f93083a3a04c517f83b.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="number-of-supported-vrfs-per-platform"></a>Number of Supported VRFs per Platform<a class="hash-link" href="#number-of-supported-vrfs-per-platform" title="Direct link to heading">#</a></h3><table><thead><tr><th>Firepower Platform</th><th>VRF Limit</th></tr></thead><tbody><tr><td>1010</td><td>N/A</td></tr><tr><td>1120</td><td>5</td></tr><tr><td>1140, 1150, 2110, 5508, 5516, 5525â€‹</td><td>10</td></tr><tr><td>2120, 5545, 5555â€‹</td><td>20</td></tr><tr><td>2130, FTDvâ€‹</td><td>30</td></tr><tr><td>2140â€‹</td><td>40</td></tr><tr><td>4110, 4112â€‹</td><td>60</td></tr><tr><td>4115, 4120â€‹</td><td>80</td></tr><tr><td>4125, 4140, 4145, 4150, 9300 SM-24/36/40/44/48/56 (per-blade)â€‹</td><td>100</td></tr><tr><td>9300 with fully populated blades (3x SM)â€‹</td><td>300</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p>VRF combined with multi-instance can provide true multi-tenancy through
routing, security policy and management plane separation. More detailed
information about VRF is available in the configuration guides for
<a href="https://www.cisco.com/c/en/us/td/docs/security/firepower/660/configuration/guide/fpmc-config-guide-v66/virtual-routing-for-firepower-threat-defense.html" target="_blank" rel="noopener noreferrer">FMC</a>
and
<a href="https://www.cisco.com/c/en/us/td/docs/security/firepower/660/fdm/fptd-fdm-config-guide-660/fptd-fdm-virtual-routers.html" target="_blank" rel="noopener noreferrer">FDM</a>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://securefirewallessentials.github.io/securefirewallessentials/docs/SF_VRF.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/snmp"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« SNMP Monitoring</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/sips-wp"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Secure IPS Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#configuration" class="table-of-contents__link">Configuration</a><ul><li><a href="#firepower-management-center" class="table-of-contents__link">Firepower Management Center</a></li><li><a href="#firepower-device-manager" class="table-of-contents__link">Firepower Device Manager</a></li></ul></li><li><a href="#multi-instance-with-vrf" class="table-of-contents__link">Multi-Instance with VRF</a></li><li><a href="#how-do-policies-interact-with-vrf" class="table-of-contents__link">How do policies interact with VRF</a><ul><li><a href="#overlapping-ip-addresses" class="table-of-contents__link">Overlapping IP addresses</a></li><li><a href="#limitations" class="table-of-contents__link">Limitations</a></li></ul></li><li><a href="#how-nat-interacts-with-vrf" class="table-of-contents__link">How NAT interacts with VRF</a><ul><li><a href="#route-leaking-using-nat" class="table-of-contents__link">Route Leaking using NAT</a></li><li><a href="#overlapping-ip-addresses-1" class="table-of-contents__link">Overlapping IP addresses</a></li></ul></li><li><a href="#verification-and-troubleshooting" class="table-of-contents__link">Verification and Troubleshooting</a><ul><li><a href="#number-of-supported-vrfs-per-platform" class="table-of-contents__link">Number of Supported VRFs per Platform</a></li></ul></li><li><a href="#summary" class="table-of-contents__link">Summary</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">FMC Best Practices</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/SNMP/">SNMP Monitoring</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://cs.co/netsec-community" target="_blank" rel="noopener noreferrer" class="footer__link-item">NetSec Community</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UC7rdKaO-3UPPXmkJkI6wgcg?view_as=subscriber" target="_blank" rel="noopener noreferrer" class="footer__link-item">NetSec YouTube Channel</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://securefirewallessentials.github.io/securefirewallessentials/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Secure Firewall Essentials</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Â© 2021 Cisco Systems, Inc.</div></div></div></footer></div>
<script src="/styles.984ba014.js"></script>
<script src="/runtime~main.32bb7309.js"></script>
<script src="/main.dcc679c3.js"></script>
<script src="/1.daadf3d3.js"></script>
<script src="/30.7c88bcd9.js"></script>
<script src="/31.d754188b.js"></script>
<script src="/935f2afb.f4b7ee82.js"></script>
<script src="/29.57805d62.js"></script>
<script src="/0d8a1c10.054f8eca.js"></script>
</body>
</html>